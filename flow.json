[{"id":"d2b6c6a9.d531b8","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"2e299254.21ad6e","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"2135ef5d.634de","type":"sqlitedb","z":"","db":"/tmp/sqlite","mode":"RWC"},{"id":"432193ca.762bdc","type":"inject","z":"d2b6c6a9.d531b8","name":"INSERT","topic":"INSERT INTO blockchainlist(currentdate, currenttime, device)  values(date('now'), time('now'), \"manual\")","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":300,"wires":[["7a9f633b.48c67c"]]},{"id":"bdadd3cf.c2848","type":"inject","z":"d2b6c6a9.d531b8","name":"SELECT","topic":"SELECT * FROM blockchainlist","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":400,"wires":[["7a9f633b.48c67c"]]},{"id":"d5273763.5c23a8","type":"inject","z":"d2b6c6a9.d531b8","name":"DELETE","topic":"DELETE from blockchainlist","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":500,"wires":[["7a9f633b.48c67c"]]},{"id":"e4609cb0.70109","type":"inject","z":"d2b6c6a9.d531b8","name":"DROP TABLE","topic":"DROP TABLE blockchainlist","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":230,"y":600,"wires":[["7a9f633b.48c67c"]]},{"id":"7a9f633b.48c67c","type":"sqlite","z":"d2b6c6a9.d531b8","mydb":"2135ef5d.634de","sqlquery":"msg.topic","sql":"","name":"","x":530,"y":340,"wires":[["b77ab1c.b27585","c20ad5c3.905e18"]]},{"id":"b77ab1c.b27585","type":"debug","z":"d2b6c6a9.d531b8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":850,"y":400,"wires":[]},{"id":"af5edd34.fa116","type":"inject","z":"d2b6c6a9.d531b8","name":"CREATE","topic":"CREATE TABLE blockchainlist(id INTEGER PRIMARY KEY AUTOINCREMENT, currentdate DATE, currenttime TIME, device TEXT)","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":200,"wires":[["7a9f633b.48c67c"]]},{"id":"c20ad5c3.905e18","type":"file","z":"d2b6c6a9.d531b8","name":"saving to DB","filename":"blockchain_db","appendNewline":true,"createDir":true,"overwriteFile":"true","x":850,"y":240,"wires":[]},{"id":"dc460953.3b9fe8","type":"function","z":"d2b6c6a9.d531b8","name":"constructor","func":"this.index= 0;\nthis.timestamp = timestamp;\nthis.data = data;\nthis.previousHash = \"0\";\nthis.hash = this.calculateHash();\nthis.nonce = 0;\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":60,"wires":[[]]},{"id":"a474ef56.34f21","type":"function","z":"d2b6c6a9.d531b8","name":"calculateHash","func":"const SHA256 = require('crypto-js/sha256')\n//return SHA256(this.index + this.previousHash + this.timestamp + this.data + this.nonce).toString();","outputs":1,"noerr":0,"x":1000,"y":60,"wires":[[]]},{"id":"2561183a.9d6548","type":"function","z":"d2b6c6a9.d531b8","name":"constructor1","func":"this.chain = [this.createGenesis()];","outputs":1,"noerr":0,"x":480,"y":600,"wires":[[]]},{"id":"26e38355.d8208c","type":"function","z":"d2b6c6a9.d531b8","name":"createGenesis","func":"return new Block(0, \"01/01/2017\", \"Genesis block\", \"0\")","outputs":1,"noerr":0,"x":700,"y":520,"wires":[[]]},{"id":"bbd20185.c00df","type":"function","z":"d2b6c6a9.d531b8","name":"latestBlock","func":"return this.chain[this.chain.length - 1]","outputs":1,"noerr":0,"x":720,"y":580,"wires":[[]]},{"id":"550aed87.2539b4","type":"function","z":"d2b6c6a9.d531b8","name":"addBlock","func":"newBlock.previousHash = this.latestBlock().hash;\nnewBlock.hash = newBlock.calculateHash();\nthis.chain.push(newBlock);","outputs":1,"noerr":0,"x":710,"y":640,"wires":[[]]},{"id":"c30fb656.317f58","type":"inject","z":"d2b6c6a9.d531b8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":740,"y":140,"wires":[[]]},{"id":"d9a7944f.e4c788","type":"rpi-sensehat in","z":"2e299254.21ad6e","name":"Temperature","motion":false,"env":true,"stick":false,"x":120,"y":180,"wires":[["1a17e554.dac36b"]]},{"id":"1a17e554.dac36b","type":"function","z":"2e299254.21ad6e","name":"temperature","func":"var datenow = Date.now();\nvar tempInput = msg.payload;\nmsg.payload = tempInput.temperature;\nvar newMsg = {\n    \"payload\" :{\n        \"date\": datenow,\n        \"temperature\": msg.payload\n    },\n    \"topic\": \"INSERT INTO blockchainlist(currentdate, temperature) values ( \" + datenow + \", \" + msg.payload + \")\"\n        };\nreturn newMsg;","outputs":1,"noerr":0,"x":300,"y":180,"wires":[["57c369e7.b644b8"]]},{"id":"6ccd9850.3feef8","type":"debug","z":"2e299254.21ad6e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":550,"y":260,"wires":[]},{"id":"5447c3da.f8b6cc","type":"inject","z":"2e299254.21ad6e","name":"INSERT","topic":"INSERT INTO blockchainlist(currentdate, currenttime, device)  values(date('now'), time('now'), \"manual\")","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":360,"wires":[[]]},{"id":"9c4db387.f7e86","type":"inject","z":"2e299254.21ad6e","name":"CREATE","topic":"CREATE TABLE blockchainlist(id INTEGER PRIMARY KEY AUTOINCREMENT, currentdate DATE, temperature TEXT)","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":260,"wires":[["57c369e7.b644b8"]]},{"id":"57c369e7.b644b8","type":"sqlite","z":"2e299254.21ad6e","mydb":"2135ef5d.634de","sqlquery":"msg.topic","sql":"","name":"","x":350,"y":260,"wires":[["6ccd9850.3feef8"]]}]